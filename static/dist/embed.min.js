!function(){var e={loaded:!0,before_load:"",after_load:"",ytplayer:"",stopInterval:!1,setup_youtube_listener:function(t){o.on("np",function(t){if(e.loaded=!1,0==t[0].length){document.getElementById("song-title").innerHTML="Empty channel. Add some songs!",$("#player_overlay").height($("#player").height()),/iPad|iPhone|iPod/.test(navigator.userAgent)||window.MSStream||$("#player_overlay").toggleClass("hide");try{e.ytplayer.stopVideo()}catch(o){}}else{void 0==s?s=t[0][0].id:s!=a&&(s=a),a=t[0][0].id,conf=t[1][0],time=t[2],n=time-conf.startTime,c=t[0][0].title,$("#player_overlay").addClass("hide");try{Suggestions.fetchYoutubeSuggests(a)}catch(o){}if(e.getTitle(c,viewers),e.setBGimage(a),!p||/iPad|iPhone|iPod/.test(navigator.userAgent)||window.MSStream)e.getTitle(c,viewers);else try{e.ytplayer.getVideoUrl().split("v=")[1]!=a&&(e.ytplayer.loadVideoById(a),e.notifyUser(a,c),e.ytplayer.seekTo(n),u&&e.ytplayer.pauseVideo()),u||(e.ytplayer.playVideo(),e.durationSetter()),(e.ytplayer.getDuration()>n||0==e.ytplayer.getDuration())&&e.ytplayer.seekTo(n),e.after_load=a,setTimeout(function(){e.loaded=!0},500)}catch(o){e.durationSetter()}}}),o.on("viewers",function(t){viewers=t,void 0!==c&&e.getTitle(c,viewers)})},onPlayerStateChange:function(t){switch(t.data){case-1:break;case 0:playing=!1,u=!1,o.emit("end",a);break;case 1:playing=!0,beginning&&window.mobilecheck()&&(e.ytplayer.pauseVideo(),beginning=!1),1==document.getElementById("play").className.split(" ").length&&$("#play").toggleClass("hide"),2==document.getElementById("pause").className.split(" ").length&&$("#pause").toggleClass("hide"),u&&(o.emit("pos"),u=!1);break;case 2:u=!0,1==document.getElementById("pause").className.split(" ").length&&$("#pause").toggleClass("hide"),2==document.getElementById("play").className.split(" ").length&&$("#play").toggleClass("hide");break;case 3:}},getTitle:function(e,t){var n=t>1?"viewers":"viewer",o=decodeURIComponent(e),a=document.getElementById("song-title"),i=document.getElementById("viewers");document.title=o+" • Zöff / "+_,a.innerHTML=o,i.innerHTML=t+" "+n,a.title=o+" • "+t+" "+n},errorHandler:function(t){5==t.data||100==t.data||101==t.data||150==t.data?(curr_playing=e.ytplayer.getVideoUrl().replace("https://www.youtube.com/watch?v=",""),o.emit("skip",{error:t.data,id:a,pass:w})):void 0!==a&&e.ytplayer.loadVideoById(a)},onPlayerReady:function(t){$("#channel-load").css("display","none");try{beginning=!0,p=!0,/iPad|iPhone|iPod/.test(navigator.userAgent)||window.MSStream||($("#player").css("opacity","1"),$("#controls").css("opacity","1"),$(".playlist").css("opacity","1"),window.ytplayer=e.ytplayer,e.ytplayer.loadVideoById(a),e.ytplayer.playVideo(),e.durationSetter(),e.ytplayer.seekTo(n)),e.readyLooks(),l.initYoutubeControls(e.ytplayer),l.initSlider(),e.ytplayer.setVolume(Crypt.get_volume())}catch(o){}},readyLooks:function(){e.setBGimage(a)},setBGimage:function(e){if(void 0!==e&&!v){var n=new Image;n.onload=function(){var e=new ColorThief,o=e.getColor(n);document.getElementsByTagName("body")[0].style.backgroundColor=t.rgbToHsl(o),$("meta[name=theme-color]").attr("content",t.rgbToHex(o[0],o[1],o[2]))},n.crossOrigin="Anonymous",n.src="https://zoff.no:8080/https://img.youtube.com/vi/"+e+"/mqdefault.jpg"}},set_width:function(e){$(".video-container").width(e)},notifyUser:function(e,t){if(t=t.replace(/\\\'/g,"'").replace(/&quot;/g,"'").replace(/&amp;/g,"&"),"granted"===Notification.permission&&document.hidden){var n=new Notification("Now Playing",{body:t,icon:"http://i.ytimg.com/vi/"+e+"/mqdefault.jpg",iconUrl:"http://i.ytimg.com/vi/"+e+"/mqdefault.jpg"});n.onclick=function(e){window.focus(),this.cancel()},setTimeout(function(){n.close()},5e3)}},setup_all_listeners:function(){o.on("get_list",function(){o.emit("list",_.toLowerCase())}),e.setup_youtube_listener(_),Admin.admin_listener(),Chat.setup_chat_listener(_),Chat.allchat_listener(),d.channel_listener(),d.skipping_listener()},onYouTubeIframeAPIReady:function(){e.ytplayer=new YT.Player("player",{videoId:"asd",playerVars:{rel:"0",wmode:"transparent",controls:"0",iv_load_policy:"3",theme:"light",color:"white"},events:{onReady:e.onPlayerReady,onStateChange:e.onPlayerStateChange,onError:e.errorHandler}})},durationSetter:function(){try{duration=e.ytplayer.getDuration()}catch(n){duration=0}if(void 0!=duration)try{dMinutes=Math.floor(duration/60),dSeconds=duration-60*dMinutes,currDurr=e.ytplayer.getCurrentTime(),currDurr>duration&&(currDurr=duration),minutes=Math.floor(currDurr/60),seconds=currDurr-60*minutes,document.getElementById("duration").innerHTML=t.pad(minutes)+":"+t.pad(seconds)+" <span id='dash'>/</span> "+t.pad(dMinutes)+":"+t.pad(dSeconds),per=100/duration*currDurr,per>=100?per=100:0==duration&&(per=0),$("#bar").width(per+"%")}catch(n){}e.stopInterval||setTimeout(e.durationSetter,1e3)},loadPlayer:function(){1==$("script[src='https://www.youtube.com/iframe_api']").length?e.onYouTubeIframeAPIReady():(tag=document.createElement("script"),tag.src="https://www.youtube.com/iframe_api",firstScriptTag=document.getElementsByTagName("script")[0],firstScriptTag.parentNode.insertBefore(tag,firstScriptTag))}};window.mobilecheck=function(){var e=!1;return function(t){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))&&(e=!0)}(navigator.userAgent||navigator.vendor||window.opera),e};var t={rnd:function(e){return e[Math.floor(Math.random()*e.length)]},predicate:function(){for(var e,t,n,o=[],a=arguments.length,i=function(e,t){return e===t?0:t>e?-1:1},s=function(e,t){var n=i,o=i;return e&&(o=function(t,o){return n(e(t),e(o))}),t?function(e,t){return-1*o(e,t)}:o},l=0;a>l;l++)e=arguments[l],"string"==typeof e?(t=e,n=i):(t=e.name,n=s(e.primer,e.reverse)),o.push({name:t,cmp:n});return function(t,n){for(var i,s,l=0;a>l&&(s=0,e=o[l],i=e.name,s=e.cmp(t[i],n[i]),0===s);l++);return s}},hashCode:function(e){for(var t=0,n=0;n<e.length;n++)t=e.charCodeAt(n)+((t<<5)-t);return t},intToARGB:function(e){return(e>>24&255).toString(16)+(e>>16&255).toString(16)+(e>>8&255).toString(16)+(255&e).toString(16)},pad:function(e){return 10>e?"0"+Math.floor(e):Math.floor(e)},contains:function(e,t){for(var n=e.length;n--;)if(e[n]===t)return!0;return!1},sample:function(){Date.now()-lastSample>=2*SAMPLE_RATE&&(o.removeAllListeners(),o.disconnect(),o.connect(),e.setup_all_listeners()),lastSample=Date.now(),setTimeout(t.sample,SAMPLE_RATE)},loadjsfile:function(e){if(-1==filesadded.indexOf("["+e+"]")){var t=document.createElement("script");t.setAttribute("type","text/javascript"),t.setAttribute("src",e),document.getElementsByTagName("head")[0].appendChild(t),filesadded+="["+e+"]"}},msieversion:function(){var e=window.navigator.userAgent,t=e.indexOf("MSIE ");return t>0||navigator.userAgent.match(/Trident.*rv\:11\./)?!0:!1},getRandomInt:function(e,t){return Math.floor(Math.random()*(t-e))+e},rgbToHsl:function(e){r=e[0],g=e[1],b=e[2],r/=255,g/=255,b/=255;var t,n,o=Math.max(r,g,b),a=Math.min(r,g,b),i=(o+a)/2;if(o==a)t=n=0;else{var s=o-a;switch(n=i>.5?s/(2-o-a):s/(o+a),o){case r:t=(g-b)/s+(g<b?6:0);break;case g:t=(b-r)/s+2;break;case b:t=(r-g)/s+4}t/=6}return i>.5&&(i=.5),"hsl("+Math.floor(360*t)+", "+Math.floor(100*n)+"%, "+Math.floor(100*i)+"%)"},componentToHex:function(e){var t=e.toString(16);return 1==t.length?"0"+t:t},rgbToHex:function(e,n,o){return"#"+t.componentToHex(e)+t.componentToHex(n)+t.componentToHex(o)}};Element.prototype.remove=function(){this.parentElement.removeChild(this)},NodeList.prototype.remove=HTMLCollection.prototype.remove=function(){for(var e=0,t=this.length;t>e;e++)this[e]&&this[e].parentElement&&this[e].parentElement.removeChild(this[e])},String.prototype.startsWith=function(e,t){return t=t||0,this.indexOf(e,t)===t};var n,o,a,s,l={stopInterval:!1,initYoutubeControls:function(){!window.mobilecheck()||/iPad|iPhone|iPod/.test(navigator.userAgent)||window.MSStream||$("#controls").appendTo("#playbar"),l.initControls()},initControls:function(){document.getElementById("volume-button").addEventListener("click",l.mute_video),document.getElementById("playpause").addEventListener("click",l.play_pause),document.getElementById("fullscreen").addEventListener("click",l.fullscreen)},initSlider:function(){try{f=Crypt.get_volume()}catch(e){}$("#volume").slider({min:0,max:100,value:f,range:"min",animate:!0,slide:function(e,t){l.setVolume(t.value);try{Crypt.set_volume(t.value)}catch(n){}}}),l.choose_button(f,!1)},fullscreen:function(){var e=document.getElementById("player"),t=e.requestFullScreen||e.mozRequestFullScreen||e.webkitRequestFullScreen;t&&t.bind(e)()},play_pause:function(){1==e.ytplayer.getPlayerState()?(e.ytplayer.pauseVideo(),!window.mobilecheck()||/iPad|iPhone|iPod/.test(navigator.userAgent)||window.MSStream||(document.getElementById("player").style.display="none")):(2==e.ytplayer.getPlayerState()||0==e.ytplayer.getPlayerState())&&(e.ytplayer.playVideo(),!window.mobilecheck()||/iPad|iPhone|iPod/.test(navigator.userAgent)||window.MSStream||(document.getElementById("player").style.display="block"))},settings:function(){$("#qS").toggleClass("hide")},changeQuality:function(t){e.ytplayer.getPlaybackQuality!=t&&(e.ytplayer.setPlaybackQuality(t),e.ytplayer.getPlaybackQuality()),$("#qS").toggleClass("hide")},mute_video:function(){e.ytplayer.isMuted()?(e.ytplayer.unMute(),l.choose_button(e.ytplayer.getVolume(),!1)):(l.choose_button(0,!0),e.ytplayer.mute())},setVolume:function(t){e.ytplayer.setVolume(t),l.choose_button(t,!1),e.ytplayer.isMuted()&&e.ytplayer.unMute()},choose_button:function(e,t){t?(1==document.getElementById("v-full").className.split(" ").length&&$("#v-full").toggleClass("hide"),1==document.getElementById("v-medium").className.split(" ").length&&$("#v-medium").toggleClass("hide"),1==document.getElementById("v-low").className.split(" ").length&&$("#v-low").toggleClass("hide"),2==document.getElementById("v-mute").className.split(" ").length&&$("#v-mute").toggleClass("hide")):e>=0&&33>=e?(1==document.getElementById("v-full").className.split(" ").length&&$("#v-full").toggleClass("hide"),1==document.getElementById("v-medium").className.split(" ").length&&$("#v-medium").toggleClass("hide"),2==document.getElementById("v-low").className.split(" ").length&&$("#v-low").toggleClass("hide"),1==document.getElementById("v-mute").className.split(" ").length&&$("#v-mute").toggleClass("hide")):e>=34&&66>=e?(1==document.getElementById("v-full").className.split(" ").length&&$("#v-full").toggleClass("hide"),2==document.getElementById("v-medium").className.split(" ").length&&$("#v-medium").toggleClass("hide"),1==document.getElementById("v-low").className.split(" ").length&&$("#v-low").toggleClass("hide"),1==document.getElementById("v-mute").className.split(" ").length&&$("#v-mute").toggleClass("hide")):e>=67&&100>=e&&(2==document.getElementById("v-full").className.split(" ").length&&$("#v-full").toggleClass("hide"),1==document.getElementById("v-medium").className.split(" ").length&&$("#v-medium").toggleClass("hide"),1==document.getElementById("v-low").className.split(" ").length&&$("#v-low").toggleClass("hide"),1==document.getElementById("v-mute").className.split(" ").length&&$("#v-mute").toggleClass("hide"))},playPause:function(){state=e.ytplayer.getPlayerState(),button=document.getElementById("playpause"),1==state?e.ytplayer.pauseVideo():2==state&&e.ytplayer.playVideo()},volumeOptions:function(){e.ytplayer.isMuted()?(e.ytplayer.unMute(),f=e.ytplayer.getVolume(),$("#volume").slider("value",e.ytplayer.getVolume())):(e.ytplayer.mute(),$("#volume").slider("value",0))},hoverMute:function(t){f=e.ytplayer.getVolume()}},d={channel_listener:function(){o.on("channel",function(e){d.channel_function(e)})},channel_function:function(e){switch(e[0]){case"list":d.populate_list(e[1]);break;case"added":d.added_song(e[1]);break;case"deleted":d.deleted_song(e[1]);break;case"vote":d.voted_song(e[1],e[2]);break;case"song_change":d.song_change(e[1])}},populate_list:function(e){full_playlist=e,d.sortList(),$("#wrapper").empty(),$.each(full_playlist,function(e,t){t.now_playing||$("#wrapper").append(d.generateSong(t,!1,y,!0))}),y&&(window.mobilecheck()?$(".list-image").lazyload({}):$(".list-image").lazyload({container:$("#wrapper")}).removeClass("lazy")),$("#settings").css("visibility","visible"),$("#settings").css("opacity","1"),$("#wrapper").css("opacity","1")},added_song:function(e){full_playlist.push(e),d.sortList(),$("#suggested-"+e.id).remove(),d.insertAtIndex(e,!0)},deleted_song:function(e){var t=d.getIndexOfSong(e),n=$("#wrapper").children()[t];try{n.style.height=0,setTimeout(function(){$("#"+e).remove(),full_playlist.splice(d.getIndexOfSong(e),1)},305),document.getElementById("wrapper").scrollTop+=1,document.getElementById("wrapper").scrollTop+=-1}catch(o){full_playlist.splice(d.getIndexOfSong(e),1),$("#wrapper").children()[$("#wrapper").children().length-1].remove()}$("#suggested-"+e).remove(),Suggestions.checkUserEmpty()},voted_song:function(e,t){var n=d.getIndexOfSong(e),o=full_playlist[n];full_playlist[n].votes+=1,full_playlist[n].added=t,d.sortList(),$("#"+e).remove(),d.insertAtIndex(o,!1)},song_change:function(e){var t=full_playlist.length-1;full_playlist[0].now_playing=!0,full_playlist[0].votes=0,full_playlist[0].guids=[],full_playlist[0].added=e,full_playlist[t].now_playing=!1,full_playlist.push(full_playlist.shift()),$("#wrapper").children()[0].remove(),d.insertAtIndex(full_playlist[t-1],!1),document.getElementById("wrapper").scrollTop+=1,document.getElementById("wrapper").scrollTop+=-1},vote:function(e,t){return o.emit("vote",[_,e,t,w]),!0},skip:function(){return o.emit("skip",{pass:w,id:a}),!0},importOldList:function(e){var t="",n=0;playlist_url="lists/"+e+".json",list=$.parseJSON($.ajax({type:"GET",url:playlist_url,async:!1}).responseText),$.each(list.songs,function(e,o){t+=o.id+",",n>45&&(Search.addVideos(t),t="",n=0),n++}),Search.addVideos(t),document.getElementById("search").value=""},sortList:function(){full_playlist.sort(t.predicate({name:"votes",reverse:!0},"added"))},show:function(){window.mobilecheck()||(showToggle?(showToggle=!1,$("#toptitle").empty(),$("#chan").addClass("bigChan"),$("#chan").html("zoff.no/"+_.toLowerCase())):(showToggle=!0,$("#toptitle").html("Zöff"),$("#chan").removeClass("bigChan"),$("#chan").html(_)))},insertAtIndex:function(e,t){i=d.getIndexOfSong(e.id),0===i?$("#wrapper").prepend(d.generateSong(e,t,!1,!0,!1)):$("#wrapper > div:nth-child("+i+")").after(d.generateSong(e,t,!1,!0,!1)),t&&setTimeout(function(){var e=$("#wrapper").children()[i];$(e).css("height",66)},5)},generateSong:function(e,t,n,o,a){var i,s,l=e.id,r=e.title,d=e.votes,c="background-image:url('//img.youtube.com/vi/"+l+"/mqdefault.jpg');",u=$("<div>"+m+"</div>"),p="style";return t&&u.find("#list-song").css("height",0),h||u.find(".card-action").removeClass("hide"),1==d&&u.find(".vote-text").text("vote"),n&&(c="//img.youtube.com/vi/"+l+"/mqdefault.jpg",p="data-original"),o?(u.find(".list-votes").text(d),u.find("#list-song").attr("id",l),i=".vote-container",s="del"):o||(u.find(".vote-text").text(e.duration),i=".add-suggested",s=a?"del_user_suggested":"del_suggested",u.find(".vote-container").attr("class","clickable add-suggested"),u.find(".add-suggested").attr("title","Add song!"),u.find("#del").attr("id",s),u.find(i).attr("data-video-title",r),u.find(i).attr("data-video-length",e.length),u.find("#list-song").attr("id","suggested-"+l),u.find(".list-image").attr("class",u.find(".list-image").attr("class").replace("list-image","list-suggested-image"))),u.find(".list-title").text(r),u.find(".list-title").attr("title",r),u.find(i).attr("data-video-id",l),u.find(".list-image").attr(p,c),u.find(".list-suggested-image").attr(p,c),u.find("#"+s).attr("data-video-id",l),u.html()},getIndexOfSong:function(e){return indexes=$.map(full_playlist,function(t,n){return t.id==e?n:void 0}),indexes[0]}},c="",u=!1,p=!1,m=$("#list-song-html").html(),h=!0,y=!1,v=!0,f=100,w="",_=$("#zoffchannel").html().toLowerCase(),k={"sync disconnect on unload":!0,secure:!0,"force new connection":!0};$(document).ready(function(){$("head").append('<link type="text/css" rel="stylesheet" href="/static/css/embed.css" />'),$("head").append('<link type="text/css" rel="stylesheet" href="/static/css/materialize.min.css" />'),add="https://zoff.no",o=io.connect(""+add+":8880",k),o.on("get_list",function(){setTimeout(function(){o.emit("list",_.toLowerCase())},1e3)}),e.setup_youtube_listener(_),d.channel_listener(),window.onYouTubeIframeAPIReady=e.onYouTubeIframeAPIReady,e.loadPlayer(),l.initSlider()}),$(document).on("click",".vote-container",function(e){var t=$(this).attr("data-video-id");d.vote(t,"pos")})}();